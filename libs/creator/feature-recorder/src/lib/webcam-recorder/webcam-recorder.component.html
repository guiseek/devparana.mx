<section>
  <div class="container">
    <video
      #recorderRef
      playsinline
      autoplay
      [ngClass]="{ hidden: (completed$ | async) }"
    ></video>
    <video
      #recordedRef
      playsinline
      controls
      [ngClass]="{ hidden: !(completed$ | async) }"
    ></video>
  </div>
</section>

<ng-container *ngIf="countdown$ | async as countdown">
  <div class="countdown">
    <span [ngClass]="{ ping: countdown >= 0 }">{{ countdown }}</span>
  </div>
</ng-container>

<footer class="toolbar">
  <button
    mat-fab
    matTooltip="Capturar"
    [disabled]="stream?.active"
    (click)="capture()"
  >
    <mat-icon>video_camera_front</mat-icon>
  </button>

  <div>
    <button
      mat-mini-fab
      matTooltip="Iniciar gravação"
      [disabled]="!stream?.active || !!recorder?.state"
      (click)="start()"
    >
      <mat-icon>play_arrow</mat-icon>
    </button>
    <button
      mat-mini-fab
      [matTooltip]="
        recorder?.state == 'paused' ? 'Continuar gravação' : 'Pausar gravação'
      "
      [disabled]="disableToggle"
      (click)="toggleRecording()"
    >
      <mat-icon>
        {{ recorder?.state == 'paused' ? 'not_started' : 'pause' }}
      </mat-icon>
    </button>
    <button
      [disabled]="recorder?.state != 'recording'"
      mat-mini-fab
      matTooltip="Parar gravação"
      (click)="stop()"
    >
      <mat-icon>stop</mat-icon>
    </button>
    <button
      [disabled]="recorder?.state != 'inactive'"
      mat-mini-fab
      matTooltip="Descartar"
      (click)="stop()"
    >
      <mat-icon>undo</mat-icon>
    </button>
  </div>

  <button
    mat-fab
    matTooltip="Download"
    [disabled]="recorder?.state != 'inactive'"
    (click)="download()"
  >
    <mat-icon>download</mat-icon>
  </button>
</footer>
